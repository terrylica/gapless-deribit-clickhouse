branches:
  - main

plugins:
  # Analyze commits to determine version bump
  # Use conventionalcommits preset for feat!: breaking change notation
  - - "@semantic-release/commit-analyzer"
    - preset: conventionalcommits

  # Generate release notes from commits
  - - "@semantic-release/release-notes-generator"
    - preset: conventionalcommits

  # Update CHANGELOG.md
  - - "@semantic-release/changelog"
    - changelogFile: CHANGELOG.md

  # Update version in pyproject.toml and build package
  - - "@semantic-release/exec"
    - prepareCmd: "sed -i.bak 's/^version = \".*\"/version = \"${nextRelease.version}\"/' pyproject.toml && rm pyproject.toml.bak && ~/.local/share/mise/installs/uv/0.9.17/uv-aarch64-apple-darwin/uv build"
      publishCmd: "echo 'Python package built successfully'"

  # Commit version changes back to repository
  - - "@semantic-release/git"
    - assets:
        - pyproject.toml
        - CHANGELOG.md
        - package.json
      message: "chore(release): ${nextRelease.version} [skip ci]\n\n${nextRelease.notes}"

  # Create GitHub release
  - - "@semantic-release/github"
    - assets:
        - path: "dist/*.whl"
        - path: "dist/*.tar.gz"
